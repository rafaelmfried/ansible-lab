---
- name: Provisionar PostgreSQL na VM de banco de dados
  hosts: database
  become: true
  vars_files:
    - ../group_vars/database/main.yml
  pre_tasks:
    - name: Verificar vault do database (local)
      become: false
      stat:
        path: ../group_vars/database/vault.yml
      register: postgres_vault_stat

    - name: Carregar vault do database (local, se existir)
      become: false
      include_vars:
        file: ../group_vars/database/vault.yml
      no_log: true
      when: postgres_vault_stat.stat.exists
  roles:
    - role: postgres_server
